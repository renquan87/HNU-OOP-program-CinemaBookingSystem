# ç”µå½±é™¢è®¢ç¥¨ç³»ç»Ÿ - å‰åç«¯é€šä¿¡è¯¦ç»†æŒ‡å—

> æœ¬æ–‡æ¡£ä¸ºåˆå­¦è€…è¯¦ç»†è®²è§£æœ¬é¡¹ç›®çš„å‰åç«¯é€šä¿¡æœºåˆ¶ï¼Œå¸®åŠ©ç†è§£ç³»ç»Ÿå¦‚ä½•å·¥ä½œã€‚

---

## ç›®å½•
1. [ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ](#ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ)
2. [é€šä¿¡åŸºç¡€](#é€šä¿¡åŸºç¡€)
3. [æ ¸å¿ƒAPIæ¥å£è¯¦è§£](#æ ¸å¿ƒapiæ¥å£è¯¦è§£)
4. [é€šä¿¡æµç¨‹ç¤ºä¾‹](#é€šä¿¡æµç¨‹ç¤ºä¾‹)
5. [æ•°æ®æ ¼å¼è¯´æ˜](#æ•°æ®æ ¼å¼è¯´æ˜)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç³»ç»Ÿæ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æµè§ˆå™¨ï¼ˆå‰ç«¯ï¼‰                            â”‚
â”‚  Vue 3 + TypeScript + Vite                                  â”‚
â”‚  â€¢ ç”¨æˆ·ç•Œé¢å±•ç¤º                                              â”‚
â”‚  â€¢ äº‹ä»¶å¤„ç†ï¼ˆç‚¹å‡»ã€é€‰åº§ç­‰ï¼‰                                   â”‚
â”‚  â€¢ API è°ƒç”¨è¯·æ±‚                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ HTTP è¯·æ±‚/å“åº”
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Vite ä»£ç†æœåŠ¡å™¨    â”‚
        â”‚ (localhost:5173)    â”‚
        â”‚  ä»£ç†æ‰€æœ‰ /api è¯·æ±‚  â”‚
        â”‚  è½¬å‘åˆ°åç«¯ :8081   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ HTTP è¯·æ±‚/å“åº”
                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Java Spring Boot åç«¯æœåŠ¡                         â”‚
â”‚  (localhost:8081)                                            â”‚
â”‚  â€¢ @RestController å¤„ç† API è¯·æ±‚                            â”‚
â”‚  â€¢ ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆè®¢ç¥¨ã€æ”¯ä»˜ç­‰ï¼‰                              â”‚
â”‚  â€¢ æ•°æ®åº“æ“ä½œï¼ˆMySQLï¼‰                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ SQL æŸ¥è¯¢/æ›´æ–°
                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   MySQL æ•°æ®åº“      â”‚
        â”‚  æŒä¹…åŒ–å­˜å‚¨æ•°æ®      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç«¯å£é…ç½®

| ç»„ä»¶ | åœ°å€ | ç«¯å£ | è¯´æ˜ |
|------|------|------|------|
| å‰ç«¯åº”ç”¨ | `http://localhost:5173` | 5173 | Vite å¼€å‘æœåŠ¡å™¨ |
| åç«¯åº”ç”¨ | `http://localhost:8081` | 8081 | Spring Boot API æœåŠ¡å™¨ |
| æ•°æ®åº“ | localhost | 3306 | MySQL æ•°æ®åº“ |

---

## é€šä¿¡åŸºç¡€

### ä»€ä¹ˆæ˜¯ HTTP è¯·æ±‚ï¼Ÿ

å‰åç«¯é€šè¿‡ HTTP åè®®é€šä¿¡ã€‚HTTP è¯·æ±‚åŒ…æ‹¬ï¼š

```
GET /api/shows?movieId=MOV-001 HTTP/1.1
Host: localhost:8081
Content-Type: application/json
Authorization: Bearer fake-token-USER-001

{ "userId": "USER-001" }
```

**é‡è¦æ¦‚å¿µï¼š**
- **è¯·æ±‚æ–¹æ³•**ï¼šGETã€POSTã€PUTã€DELETE ç­‰
- **URL è·¯å¾„**ï¼šæœåŠ¡å™¨ä¸Šçš„èµ„æºä½ç½®
- **è¯·æ±‚å¤´**ï¼šé™„åŠ ä¿¡æ¯ï¼ˆContent-Type ç­‰ï¼‰
- **è¯·æ±‚ä½“**ï¼šPOST/PUT æ–¹æ³•çš„æ•°æ®ï¼ˆJSON æ ¼å¼ï¼‰

### è¯·æ±‚å’Œå“åº”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯å‘é€è¯·æ±‚        â”‚
â”‚  (Request)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯æ¥æ”¶ã€å¤„ç†è¯·æ±‚   â”‚
â”‚  è°ƒç”¨ API æ–¹æ³•      â”‚
â”‚  å¤„ç†ä¸šåŠ¡é€»è¾‘        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åç«¯è¿”å›å“åº”        â”‚
â”‚  (Response)         â”‚
â”‚  JSON æ ¼å¼æ•°æ®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å‰ç«¯æ¥æ”¶å“åº”        â”‚
â”‚  æ›´æ–°é¡µé¢æ˜¾ç¤º        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ‡å‡†å“åº”æ ¼å¼

æœ¬é¡¹ç›®çš„æ‰€æœ‰ API å“åº”éƒ½éµå¾ªç»Ÿä¸€çš„æ ¼å¼ï¼š

```json
{
  "success": true,           // æ“ä½œæ˜¯å¦æˆåŠŸ
  "code": 200,              // HTTP çŠ¶æ€ç 
  "message": "æ“ä½œæˆåŠŸ",     // æç¤ºæ¶ˆæ¯
  "data": {                 // å®é™…æ•°æ®ï¼ˆå¯é€‰ï¼‰
    "orderId": "ORD-001",
    "totalAmount": 100
  }
}
```

**å¤±è´¥å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "success": false,
  "code": 400,
  "message": "è´¦å·æˆ–å¯†ç é”™è¯¯"
}
```

---

## æ ¸å¿ƒAPIæ¥å£è¯¦è§£

### 1. ç”¨æˆ·è®¤è¯ç›¸å…³æ¥å£

#### 1.1 ç™»å½•æ¥å£

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
POST /api/login
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼ˆå‰ç«¯å‘é€ï¼‰ï¼š**
```json
{
  "username": "user123",     // ç”¨æˆ·ID
  "password": "password123"  // å¯†ç 
}
```

**å“åº”ä½“ï¼ˆåç«¯è¿”å›ï¼‰ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "userId": "user123",                    // ğŸ”´ é‡è¦ï¼šåç»­ä¸‹å•éœ€è¦
    "username": "user123",
    "accessToken": "fake-token-user123",    // ä»¤ç‰Œï¼ˆç”¨äºéªŒè¯ï¼‰
    "roles": ["common"],                     // ç”¨æˆ·è§’è‰²ï¼šcommon æˆ– admin
    "expires": "2030/01/01 00:00:00"        // ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  }
}
```

**å‰ç«¯ä»£ç ï¼ˆä½ç½®ï¼š`web/src/api/user.ts`ï¼‰ï¼š**
```typescript
export const getLogin = (data?: object) => {
  return http.request<UserResult>("post", "/api/login", { data });
};
```

**åç«¯ä»£ç ï¼ˆä½ç½®ï¼š`src/main/java/com/cinema/controller/AuthController.java`ï¼‰ï¼š**
```java
@PostMapping("/login")
public Map<String, Object> login(@RequestBody LoginRequest request) {
    Map<String, Object> response = new HashMap<>();
    CinemaManager manager = CinemaManager.getInstance();
    User user = manager.getUser(request.username);
    
    if (user != null && user.getPassword().equals(request.password)) {
        // ç™»å½•æˆåŠŸï¼Œè¿”å›ç”¨æˆ·ä¿¡æ¯
        response.put("success", true);
        response.put("code", 200);
        response.put("data", Map.of(
            "userId", user.getId(),
            "username", user.getName(),
            "accessToken", "fake-token-" + user.getId(),
            "roles", user.isAdmin() ? new String[]{"admin"} : new String[]{"common"}
        ));
    } else {
        // ç™»å½•å¤±è´¥
        response.put("success", false);
        response.put("code", 401);
        response.put("message", "è´¦å·æˆ–å¯†ç é”™è¯¯");
    }
    return response;
}
```

#### 1.2 æ³¨å†Œæ¥å£

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
POST /api/register
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "username": "newuser",    // ç”¨æˆ·IDï¼ˆå”¯ä¸€ï¼‰
  "password": "pass123",    // å¯†ç 
  "nickname": "å¼ ä¸‰",        // ç”¨æˆ·æ˜µç§°
  "phone": "13800138000",   // ç”µè¯
  "email": "user@example.com" // é‚®ç®±
}
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•",
  "data": {
    "username": "newuser",
    "name": "å¼ ä¸‰"
  }
}
```

---

### 2. ç”µå½±å’Œæ”¾æ˜ ä¿¡æ¯æ¥å£

#### 2.1 è·å–æ‰€æœ‰ç”µå½±

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
GET /api/movies
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": "MOV-001",
      "title": "é»‘è±¹2",
      "director": "å¯¼æ¼”å",
      "duration": 120,          // ç”µå½±æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
      "rating": 8.5,            // è¯„åˆ†
      "genre": "ç§‘å¹»",
      "releaseTime": "2023-01-01",
      "description": "ç”µå½±æè¿°",
      "actors": ["æ¼”å‘˜1", "æ¼”å‘˜2"],
      "trailerUrl": "xxx",
      "coverUrl": "xxx",
      "comments": []            // ç”¨æˆ·è¯„è®º
    }
  ]
}
```

#### 2.2 è·å–æŸç”µå½±çš„æ‰€æœ‰åœºæ¬¡

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
GET /api/shows?movieId=MOV-001
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": {
    "serverTime": "2024-12-23T10:30:00",
    "upcomingShows": [          // æœªæ¥çš„åœºæ¬¡
      {
        "id": "SHOW-001",
        "movieTitle": "é»‘è±¹2",
        "movieId": "MOV-001",
        "roomName": "1å·å…",
        "roomId": "ROOM-001",
        "startTime": "2024-12-24T14:00:00",
        "basePrice": 45,         // åŸºç¡€ç¥¨ä»·
        "availableSeats": 50,    // å¯ç”¨åº§ä½æ•°
        "totalSeats": 100,       // æ€»åº§ä½æ•°
        "status": "UPCOMING"
      }
    ],
    "historyShows": [           // å·²è¿‡æœŸçš„åœºæ¬¡
      {
        "id": "SHOW-002",
        "movieTitle": "é»‘è±¹2",
        "startTime": "2024-12-20T14:00:00",
        "status": "HISTORY"
      }
    ]
  }
}
```

---

### 3. åº§ä½ç®¡ç†æ¥å£

#### 3.1 è·å–æŸåœºæ¬¡çš„åº§ä½ä¿¡æ¯

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
GET /api/shows/{showId}/seats
```

**è¯·æ±‚ç¤ºä¾‹ï¼š**
```
GET /api/shows/SHOW-001/seats
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": "1-1",              // åº§ä½IDï¼ˆè¡Œ-åˆ—ï¼‰
      "row": 1,                 // è¡Œå·
      "col": 1,                 // åˆ—å·
      "type": "regular",        // åº§ä½ç±»å‹ï¼šregular(æ™®é€š) | vip | discount(ä¼˜æƒ )
      "status": "available",    // åº§ä½çŠ¶æ€ï¼šavailable(å¯ä¹°) | locked(å·²é”) | sold(å·²å”®)
      "price": 45               // åº§ä½ä»·æ ¼
    },
    {
      "id": "1-2",
      "row": 1,
      "col": 2,
      "type": "vip",
      "status": "sold",
      "price": 55
    }
  ]
}
```

**åº§ä½çŠ¶æ€è¯´æ˜ï¼š**
| çŠ¶æ€ | è¯´æ˜ | å¯é€‰æ“ä½œ |
|------|------|---------|
| available | å¯ç”¨åº§ä½ | ç”¨æˆ·å¯é€‰è´­ |
| locked | å·²é”å®šåº§ä½ | å…¶ä»–ç”¨æˆ·30ç§’å†…æ— æ³•è´­ä¹°ï¼ˆé˜²æ­¢å¹¶å‘ï¼‰ |
| sold | å·²å”®å‡ºåº§ä½ | æ— æ³•è´­ä¹° |

---

### 4. è®¢ç¥¨ç›¸å…³æ¥å£

#### 4.1 åˆ›å»ºè®¢å•ï¼ˆé”åº§ï¼‰

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
POST /api/booking/create
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "userId": "user123",           // ç”¨æˆ·IDï¼ˆä»ç™»å½•è¿”å›è·å¾—ï¼‰
  "showId": "SHOW-001",          // åœºæ¬¡ID
  "seatIds": ["1-1", "1-2"]      // æ‰€é€‰åº§ä½IDåˆ—è¡¨
}
```

**å…³é”®ç‚¹ï¼š**
- `userId` å¿…é¡»ä¸ç™»å½•è¿”å›çš„ `userId` ä¸€è‡´
- `seatIds` æ˜¯ç”¨æˆ·åœ¨åº§ä½å›¾ä¸­é€‰æ‹©çš„åº§ä½
- åˆ›å»ºè®¢å•åï¼Œåº§ä½çŠ¶æ€å˜ä¸º "locked"ï¼ˆé”å®šï¼‰

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "ä¸‹å•æˆåŠŸï¼Œåº§ä½å·²é”å®šï¼Œè¯·åœ¨15åˆ†é’Ÿå†…æ”¯ä»˜",
  "data": {
    "orderId": "ORD-20241223001",    // è®¢å•ID
    "totalAmount": 100,               // æ€»é‡‘é¢
    "createTime": "2024-12-23T10:30:00"
  }
}
```

**åç«¯ä»£ç æµç¨‹ï¼š**
```java
@PostMapping("/create")
public Map<String, Object> createOrder(@RequestBody BookingRequest req) {
    // 1. éªŒè¯ç”¨æˆ·å’Œåœºæ¬¡æ˜¯å¦å­˜åœ¨
    User user = cinemaManager.getUser(req.userId);
    Show show = cinemaManager.getShow(req.showId);
    
    // 2. è°ƒç”¨æœåŠ¡å±‚åˆ›å»ºé¢„è®¢ï¼ˆåŒ…å«åº§ä½é”å®šé€»è¾‘ï¼‰
    Order order = bookingService.reserveOrder(user, show, req.seatIds);
    
    // 3. è¿”å›è®¢å•ä¿¡æ¯
    return response;
}
```

#### 4.2 æ”¯ä»˜è®¢å•

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
POST /api/booking/pay
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "orderId": "ORD-20241223001"    // è¦æ”¯ä»˜çš„è®¢å•ID
}
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "æ”¯ä»˜æˆåŠŸ",
  "data": null
}
```

**è®¢å•çŠ¶æ€æµè½¬ï¼š**
```
åˆ›å»ºè®¢å•        æ”¯ä»˜æˆåŠŸ       å®Œæˆä½¿ç”¨
  â†“              â†“              â†“
RESERVED â†’ PAID â†’ COMPLETED
  â†“              â†“
15åˆ†é’Ÿæœªæ”¯ä»˜    æ”¯ä»˜å¤±è´¥
  â†“              â†“
EXPIRED         PAYMENT_FAILED
```

#### 4.3 æŸ¥è¯¢ç”¨æˆ·è®¢å•

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
GET /api/booking/my-orders?userId=user123
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "data": [
    {
      "orderId": "ORD-20241223001",
      "movieTitle": "é»‘è±¹2",
      "startTime": "2024-12-24T14:00:00",
      "roomName": "1å·å…",
      "seats": ["1-1", "1-2"],
      "totalAmount": 100,
      "status": "PAID",              // PENDING | PAID | REFUNDED | EXPIRED
      "createTime": "2024-12-23T10:30:00"
    }
  ]
}
```

#### 4.4 é€€ç¥¨æ¥å£

**è¯·æ±‚ä¿¡æ¯ï¼š**
```
POST /api/booking/refund
Content-Type: application/json
```

**è¯·æ±‚ä½“ï¼š**
```json
{
  "orderId": "ORD-20241223001"
}
```

**å“åº”ä½“ï¼š**
```json
{
  "success": true,
  "code": 200,
  "message": "é€€ç¥¨æˆåŠŸ",
  "data": null
}
```

---

## é€šä¿¡æµç¨‹ç¤ºä¾‹

### åœºæ™¯1ï¼šç”¨æˆ·å®Œæ•´è´­ç¥¨æµç¨‹

```
ç”¨æˆ·æ“ä½œ                  å‰ç«¯ä»£ç                     åç«¯å¤„ç†                  æ•°æ®åº“
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€è¾“å…¥è´¦å¯†                â”‚                           â”‚                        â”‚
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€ç‚¹å‡»ç™»å½•â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/login â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º éªŒè¯ç”¨æˆ· â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º æŸ¥è¯¢Userè¡¨
   â”‚                       â”‚         â—„â”€ è¿”å›token      â”‚                        â”‚
   â”œâ”€æŸ¥çœ‹ç”µå½±              â”‚                           â”‚                        â”‚
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€ç‚¹å‡»è´­ç¥¨â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GET /api/shows â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º è·å–åœºæ¬¡ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æŸ¥è¯¢Showè¡¨
   â”‚                       â”‚         â—„â”€ è¿”å›åœºæ¬¡åˆ—è¡¨    â”‚                        â”‚
   â”œâ”€æŸ¥çœ‹åº§ä½              â”‚                           â”‚                        â”‚
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€ç‚¹å‡»åº§ä½â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º GET /api/shows/{id}/seatsâ”€â–º è·å–åº§ä½ â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æŸ¥è¯¢Seatè¡¨
   â”‚                       â”‚         â—„â”€ è¿”å›åº§ä½å›¾      â”‚                        â”‚
   â”œâ”€é€‰æ‹©åº§ä½1,2           â”‚                           â”‚                        â”‚
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€ç‚¹å‡»ä¸‹å•â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/booking/create   â”‚ åˆ›å»ºè®¢å•              â”‚
   â”‚                       â”‚         (userId, showId,  â”‚ é”å®šåº§ä½              â”‚
   â”‚ åº§ä½ç¡®è®¤               â”‚          seatIds)         â”‚                        â”‚
   â”‚                       â”‚         â—„â”€ è¿”å›orderId    â”‚ åº§ä½çŠ¶æ€â†’locked        â”œâ”€â”€â–º æ’å…¥Order
   â”‚                       â”‚             + 15åˆ†é’Ÿå€’è®¡   â”‚                        â”‚    æ›´æ–°SeatçŠ¶æ€
   â”œâ”€æ”¯ä»˜ç¡®è®¤              â”‚                           â”‚                        â”‚
   â”‚                       â”‚                           â”‚                        â”‚
   â”œâ”€ç‚¹å‡»æ”¯ä»˜â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º POST /api/booking/pay â”€â”€â”€â”€â–º å¤„ç†æ”¯ä»˜              â”‚
   â”‚                       â”‚         (orderId)         â”‚ è®¢å•çŠ¶æ€â†’PAID          â”œâ”€â”€â–º æ›´æ–°OrderçŠ¶æ€
   â”‚ æ”¯ä»˜æˆåŠŸ               â”‚         â—„â”€ è¿”å›æˆåŠŸ       â”‚ åº§ä½çŠ¶æ€â†’sold         â”‚    æ›´æ–°SeatçŠ¶æ€
   â”‚                       â”‚                           â”‚                        â”‚
   â””â”€å®Œæˆè´­ç¥¨              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                        â”‚
                                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯2ï¼šAPI é€šä¿¡æ•°æ®ç¤ºä¾‹

**ç¬¬1æ­¥ï¼šç”¨æˆ·ç‚¹å‡»ç™»å½•**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
// web/src/views/login/index.vue
import { getLogin } from "@/api/user";

const handleLogin = async () => {
  const result = await getLogin({
    username: "user123",
    password: "pass123"
  });
  
  if (result.data.success) {
    const { userId, accessToken } = result.data.data;
    // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
    localStorage.setItem("userId", userId);
    localStorage.setItem("token", accessToken);
  }
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
POST http://localhost:8081/api/login HTTP/1.1
Content-Type: application/json

{"username":"user123","password":"pass123"}

å“åº” â†‘
{
  "success": true,
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "userId": "user123",
    "accessToken": "fake-token-user123",
    "roles": ["common"]
  }
}
```

**ç¬¬2æ­¥ï¼šæŸ¥çœ‹ç”µå½±åˆ—è¡¨**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
import { getMovieList } from "@/api/cinema";

const fetchMovies = async () => {
  const result = await getMovieList();
  movies.value = result.data.data;
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
GET http://localhost:8081/api/movies HTTP/1.1

å“åº” â†‘
{
  "success": true,
  "code": 200,
  "message": "è·å–æˆåŠŸ",
  "data": [
    {
      "id": "MOV-001",
      "title": "é»‘è±¹2",
      "rating": 8.5,
      ...
    }
  ]
}
```

**ç¬¬3æ­¥ï¼šæŸ¥è¯¢ç”µå½±åœºæ¬¡**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
const fetchShows = async (movieId) => {
  const result = await getShowList(movieId);
  shows.value = result.data.data.upcomingShows;
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
GET http://localhost:8081/api/shows?movieId=MOV-001 HTTP/1.1

å“åº” â†‘
{
  "success": true,
  "data": {
    "upcomingShows": [
      {
        "id": "SHOW-001",
        "movieTitle": "é»‘è±¹2",
        "startTime": "2024-12-24T14:00:00",
        "basePrice": 45
      }
    ]
  }
}
```

**ç¬¬4æ­¥ï¼šæŸ¥çœ‹åº§ä½å¹¶é€‰æ‹©**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
const fetchSeats = async (showId) => {
  const result = await getShowSeats(showId);
  seats.value = result.data.data;
  // ç”¨æˆ·åœ¨é¡µé¢ä¸Šç‚¹å‡»åº§ä½ï¼Œå‰ç«¯è®°å½•é€‰ä¸­çš„åº§ä½ID
  selectedSeats.value = ["1-1", "1-2"];
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
GET http://localhost:8081/api/shows/SHOW-001/seats HTTP/1.1

å“åº” â†‘
{
  "success": true,
  "data": [
    {"id": "1-1", "row": 1, "col": 1, "type": "regular", "status": "available", "price": 45},
    {"id": "1-2", "row": 1, "col": 2, "type": "regular", "status": "available", "price": 45}
  ]
}
```

**ç¬¬5æ­¥ï¼šä¸‹å•ï¼ˆé”åº§ï¼‰**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
const handleCreateOrder = async () => {
  const userId = localStorage.getItem("userId");
  const result = await createOrder({
    userId: userId,
    showId: "SHOW-001",
    seatIds: ["1-1", "1-2"]
  });
  
  if (result.data.success) {
    const { orderId } = result.data.data;
    // è¿›å…¥æ”¯ä»˜é¡µé¢
    navigateTo(`/payment/${orderId}`);
  }
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
POST http://localhost:8081/api/booking/create HTTP/1.1
Content-Type: application/json

{
  "userId": "user123",
  "showId": "SHOW-001",
  "seatIds": ["1-1", "1-2"]
}

å“åº” â†‘
{
  "success": true,
  "code": 200,
  "message": "ä¸‹å•æˆåŠŸï¼Œåº§ä½å·²é”å®šï¼Œè¯·åœ¨15åˆ†é’Ÿå†…æ”¯ä»˜",
  "data": {
    "orderId": "ORD-20241223001",
    "totalAmount": 90,
    "createTime": "2024-12-23T10:30:00"
  }
}
```

**ç¬¬6æ­¥ï¼šæ”¯ä»˜è®¢å•**

å‰ç«¯è°ƒç”¨ï¼š
```typescript
const handlePayment = async (orderId) => {
  const result = await payOrder({
    orderId: orderId
  });
  
  if (result.data.success) {
    message.success("æ”¯ä»˜æˆåŠŸ");
    // æ˜¾ç¤ºè®¢å•ç¡®è®¤é¡µé¢
  }
};
```

ç½‘ç»œæµé‡ï¼š
```
è¯·æ±‚ â†“
POST http://localhost:8081/api/booking/pay HTTP/1.1
Content-Type: application/json

{
  "orderId": "ORD-20241223001"
}

å“åº” â†‘
{
  "success": true,
  "code": 200,
  "message": "æ”¯ä»˜æˆåŠŸ"
}
```

---

## æ•°æ®æ ¼å¼è¯´æ˜

### å¸¸ç”¨æ•°æ®ç±»å‹

#### 1. ç”¨æˆ·å¯¹è±¡ (User)
```typescript
interface User {
  id: string;              // ç”¨æˆ·IDï¼ˆå”¯ä¸€ï¼‰
  name: string;            // ç”¨æˆ·å
  password: string;        // å¯†ç ï¼ˆåç«¯å­˜å‚¨ï¼Œä¸è¿”å›ï¼‰
  email: string;           // é‚®ç®±
  phone: string;           // æ‰‹æœº
  roles: string[];         // è§’è‰²ï¼š["common"] æˆ– ["admin"]
  isAdmin: boolean;        // æ˜¯å¦ç®¡ç†å‘˜
}
```

#### 2. ç”µå½±å¯¹è±¡ (Movie)
```typescript
interface Movie {
  id: string;              // ç”µå½±ID
  title: string;           // ç”µå½±æ ‡é¢˜
  director: string;        // å¯¼æ¼”
  actors: string[];        // æ¼”å‘˜åˆ—è¡¨
  duration: number;        // æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
  rating: number;          // è¯„åˆ†ï¼ˆ0-10ï¼‰
  genre: string;           // ç±»å‹ï¼šç§‘å¹»ã€æ‚¬ç–‘ã€å–œå‰§ç­‰
  description: string;     // æè¿°
  releaseTime: string;     // å‘å¸ƒæ—¥æœŸ (ISO 8601 æ ¼å¼)
  trailerUrl: string;      // é¢„å‘Šç‰‡ URL
  coverUrl: string;        // å°é¢ URL
  comments: Comment[];     // è¯„è®ºåˆ—è¡¨
}
```

#### 3. åœºæ¬¡å¯¹è±¡ (Show)
```typescript
interface Show {
  id: string;              // åœºæ¬¡ID
  movieId: string;         // ç”µå½±ID
  movieTitle: string;      // ç”µå½±æ ‡é¢˜
  roomId: string;          // æ”¾æ˜ å…ID
  roomName: string;        // æ”¾æ˜ å…åç§°
  startTime: string;       // å¼€å§‹æ—¶é—´ (ISO 8601 æ ¼å¼)
  basePrice: number;       // åŸºç¡€ç¥¨ä»·
  availableSeats: number;  // å¯ç”¨åº§ä½æ•°
  totalSeats: number;      // æ€»åº§ä½æ•°
  status: "UPCOMING" | "HISTORY";  // åœºæ¬¡çŠ¶æ€
}
```

#### 4. åº§ä½å¯¹è±¡ (Seat)
```typescript
interface Seat {
  id: string;              // åº§ä½IDï¼ˆæ ¼å¼ï¼š"1-1"ï¼‰
  row: number;             // è¡Œå·
  col: number;             // åˆ—å·
  type: "regular" | "vip" | "discount";  // åº§ä½ç±»å‹
  status: "available" | "locked" | "sold";  // åº§ä½çŠ¶æ€
  price: number;           // åº§ä½ä»·æ ¼
}
```

#### 5. è®¢å•å¯¹è±¡ (Order)
```typescript
interface Order {
  orderId: string;         // è®¢å•ID
  userId: string;          // ç”¨æˆ·ID
  showId: string;          // åœºæ¬¡ID
  movieTitle: string;      // ç”µå½±æ ‡é¢˜
  roomName: string;        // æ”¾æ˜ å…
  seats: string[];         // åº§ä½IDåˆ—è¡¨
  totalAmount: number;     // æ€»é‡‘é¢
  status: "PENDING" | "RESERVED" | "PAID" | "COMPLETED" | "REFUNDED" | "EXPIRED";
  createTime: string;      // åˆ›å»ºæ—¶é—´
}
```

### æ—¶é—´æ ¼å¼

é¡¹ç›®ä¸­ä½¿ç”¨ **ISO 8601** æ ‡å‡†æ ¼å¼ï¼š
```
2024-12-23T10:30:00     // æ ‡å‡†æ ¼å¼ï¼ˆå¸¦ Tï¼‰
2024-12-23 10:30:00     // ç®€åŒ–æ ¼å¼ï¼ˆå¸¦ç©ºæ ¼ï¼‰
```

---

## å¸¸è§é—®é¢˜

### Q1ï¼šå‰åç«¯æ€ä¹ˆé€šä¿¡çš„ï¼Ÿ

**Aï¼š** å‰ç«¯é€šè¿‡ HTTP è¯·æ±‚å‘åç«¯æœåŠ¡å™¨å‘é€æ•°æ®ï¼Œåç«¯å¤„ç†å¹¶è¿”å› JSON æ•°æ®ã€‚

æµç¨‹ï¼š
1. å‰ç«¯è°ƒç”¨ API å‡½æ•° â†’ ç”Ÿæˆ HTTP è¯·æ±‚
2. è¯·æ±‚é€šè¿‡ Vite ä»£ç†è½¬å‘åˆ°åç«¯ (localhost:8081)
3. åç«¯çš„ `@RestController` æ¥æ”¶è¯·æ±‚
4. è°ƒç”¨ä¸šåŠ¡é€»è¾‘å¤„ç†æ•°æ®
5. è¿”å› JSON æ ¼å¼çš„å“åº”
6. å‰ç«¯æ¥æ”¶å“åº”å¹¶æ›´æ–°é¡µé¢

### Q2ï¼šä¸ºä»€ä¹ˆç™»å½•åè¦ä¿å­˜ userIdï¼Ÿ

**Aï¼š** å› ä¸ºåç»­çš„è®¢ç¥¨ã€æŸ¥è¯¢è®¢å•ç­‰æ“ä½œéƒ½éœ€è¦ `userId` æ¥è¯†åˆ«ç”¨æˆ·ã€‚

```typescript
// ç™»å½•æˆåŠŸå
const { userId } = response.data.data;
localStorage.setItem("userId", userId);  // ä¿å­˜èµ·æ¥

// åç»­æ“ä½œæ—¶
const userId = localStorage.getItem("userId");
// åœ¨è°ƒç”¨åˆ›å»ºè®¢å•æ—¶ä½¿ç”¨
createOrder({ userId, showId, seatIds });
```

### Q3ï¼šåº§ä½é”å®šæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

**Aï¼š** ç”¨æˆ·ä¸‹å•æ—¶ï¼Œé€‰ä¸­çš„åº§ä½å˜ä¸º "locked" çŠ¶æ€ï¼Œå…¶ä»–ç”¨æˆ·æš‚æ—¶æ— æ³•è´­ä¹°ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†é˜²æ­¢å¹¶å‘é—®é¢˜ã€‚

ä¾‹å¦‚ï¼š
- ç”¨æˆ· A å’Œç”¨æˆ· B åŒæ—¶çœ‹åˆ°åº§ä½ "1-1" å¯ç”¨
- ç”¨æˆ· A å…ˆä¸‹å•ï¼Œåº§ä½ "1-1" è¢«é”å®š
- ç”¨æˆ· B æ­¤æ—¶å†ä¸‹å•å°±ä¼šå¤±è´¥ï¼ˆåº§ä½å·²è¢«é”å®šï¼‰

**é”å®šæ—¶é—´ï¼š** é»˜è®¤ 15 åˆ†é’Ÿï¼Œç”¨æˆ·å¿…é¡»åœ¨è¿™ä¸ªæ—¶é—´å†…å®Œæˆæ”¯ä»˜ï¼Œå¦åˆ™åº§ä½ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚

### Q4ï¼šè®¢å•çš„å„ä¸ªçŠ¶æ€æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

**Aï¼š**

| çŠ¶æ€ | è¯´æ˜ | ç”¨æˆ·å¯ä»¥åšä»€ä¹ˆ |
|------|------|---------------|
| PENDING | å¾…æ”¯ä»˜ | æ”¯ä»˜ã€å–æ¶ˆ |
| RESERVED | å·²é¢„è®¢ï¼ˆåº§ä½å·²é”å®šï¼‰ | æ”¯ä»˜ã€ç­‰å¾… |
| PAID | å·²æ”¯ä»˜ | æŸ¥çœ‹è®¢å•ã€é€€ç¥¨ |
| COMPLETED | å·²å®Œæˆ | æŸ¥çœ‹å†å²è®°å½• |
| REFUNDED | å·²é€€æ¬¾ | æ—  |
| EXPIRED | å·²è¿‡æœŸï¼ˆ15åˆ†é’Ÿæœªæ”¯ä»˜ï¼‰ | é‡æ–°è´­ç¥¨ |

### Q5ï¼šå¦‚ä½•è°ƒè¯•å‰åç«¯é€šä¿¡ï¼Ÿ

**Aï¼š** ä½¿ç”¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼š

1. **æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼š** F12 æˆ– å³é”® â†’ æ£€æŸ¥
2. **åˆ‡æ¢åˆ° Network æ ‡ç­¾**
3. **è¿›è¡Œæ“ä½œ**ï¼ˆå¦‚ç™»å½•ã€ä¸‹å•ç­‰ï¼‰
4. **æŸ¥çœ‹è¯·æ±‚å’Œå“åº”ï¼š**
   - Request Headersï¼šè¯·æ±‚å¤´
   - Request Payloadï¼šè¯·æ±‚ä½“
   - Responseï¼šå“åº”æ•°æ®

### Q6ï¼šåç«¯æ¥å£è¿”å› 404 æˆ– 5000 é”™è¯¯æ€ä¹ˆåŠï¼Ÿ

**Aï¼š**

- **404 Not Foundï¼š** è¯·æ±‚çš„èµ„æºä¸å­˜åœ¨
  - æ£€æŸ¥ URL æ˜¯å¦æ­£ç¡®
  - æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£ç¡®ï¼ˆå¦‚ userIdã€showIdï¼‰

- **500 Internal Server Errorï¼š** åç«¯ä»£ç å‡ºé”™
  - æŸ¥çœ‹åç«¯æ§åˆ¶å°çš„é”™è¯¯æ—¥å¿—
  - æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æ­£å¸¸è¿æ¥

### Q7ï¼šè·¨åŸŸé—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ

**Aï¼š** æœ¬é¡¹ç›®å·²é€šè¿‡ Vite ä»£ç†è§£å†³ã€‚å‰ç«¯è¯·æ±‚ `/api/*` ä¼šè‡ªåŠ¨ä»£ç†åˆ°åç«¯ï¼š

```typescript
// vite.config.ts
proxy: {
  "/api": {
    target: "http://localhost:8081",  // ä»£ç†ç›®æ ‡
    changeOrigin: true,                // æ”¹å˜æº
  }
}
```

æ‰€ä»¥å‰ç«¯è¯·æ±‚ï¼š
```typescript
http.request("get", "/api/shows")
```

å®é™…è¢«è½¬å‘åˆ°ï¼š
```
http://localhost:8081/api/shows
```

---

## å…³é”®æ–‡ä»¶ä½ç½®

### å‰ç«¯æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| [web/src/api/user.ts](../web/src/api/user.ts) | ç”¨æˆ·è®¤è¯ API |
| [web/src/api/cinema.ts](../web/src/api/cinema.ts) | ç”µå½±ã€åœºæ¬¡ã€åº§ä½ã€è®¢ç¥¨ API |
| [web/src/api/booking.ts](../web/src/api/booking.ts) | è®¢ç¥¨ API |
| [web/src/utils/http.ts](../web/src/utils/http.ts) | HTTP è¯·æ±‚å·¥å…· |
| [web/vite.config.ts](../web/vite.config.ts) | Vite é…ç½®ï¼ˆä»£ç†è®¾ç½®ï¼‰ |

### åç«¯æ–‡ä»¶

| æ–‡ä»¶ | ä½œç”¨ |
|------|------|
| [src/main/java/com/cinema/controller/AuthController.java](../src/main/java/com/cinema/controller/AuthController.java) | ç™»å½•ã€æ³¨å†Œ API |
| [src/main/java/com/cinema/controller/MovieController.java](../src/main/java/com/cinema/controller/MovieController.java) | ç”µå½±ç®¡ç† API |
| [src/main/java/com/cinema/controller/ShowController.java](../src/main/java/com/cinema/controller/ShowController.java) | åœºæ¬¡ç®¡ç† API |
| [src/main/java/com/cinema/controller/BookingController.java](../src/main/java/com/cinema/controller/BookingController.java) | è®¢ç¥¨ã€æ”¯ä»˜ API |
| [src/main/java/com/cinema/CinemaApplication.java](../src/main/java/com/cinema/CinemaApplication.java) | Spring Boot åº”ç”¨å¯åŠ¨ç±» |
| [src/main/resources/application.properties](../src/main/resources/application.properties) | åº”ç”¨é…ç½®ï¼ˆç«¯å£ã€æ•°æ®åº“ç­‰ï¼‰ |

---

## æ€»ç»“

è¿™ä¸ªç”µå½±é™¢è®¢ç¥¨ç³»ç»Ÿçš„å‰åç«¯é€šä¿¡éµå¾ª **RESTful API** è®¾è®¡é£æ ¼ï¼š

âœ… **ä½¿ç”¨ HTTP æ–¹æ³•** æ¥è¡¨ç¤ºæ“ä½œï¼š
- GETï¼šè·å–æ•°æ®ï¼ˆæŸ¥è¯¢ç”µå½±ã€åœºæ¬¡ã€åº§ä½ï¼‰
- POSTï¼šåˆ›å»ºæ•°æ®ï¼ˆæ³¨å†Œã€ä¸‹å•ã€æ”¯ä»˜ï¼‰
- PUTï¼šæ›´æ–°æ•°æ®
- DELETEï¼šåˆ é™¤æ•°æ®

âœ… **ç»Ÿä¸€çš„å“åº”æ ¼å¼**ï¼Œä¾¿äºå‰åç«¯è§£æ

âœ… **é€šè¿‡ Vite ä»£ç†è§£å†³è·¨åŸŸé—®é¢˜**

âœ… **æ¸…æ™°çš„ä¸šåŠ¡æµç¨‹**ï¼šç™»å½• â†’ æŸ¥çœ‹ç”µå½± â†’ æŸ¥çœ‹åœºæ¬¡ â†’ é€‰æ‹©åº§ä½ â†’ ä¸‹å• â†’ æ”¯ä»˜

å¸Œæœ›è¿™ä»½æ–‡æ¡£èƒ½å¸®åŠ©ä½ ç†è§£ç³»ç»Ÿçš„å·¥ä½œåŸç†ï¼æœ‰é—®é¢˜æ¬¢è¿æé—® ğŸ˜Š

